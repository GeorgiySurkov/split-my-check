# split-my-check

Приложение на платформе Telegram Web Apps для разделения общего счета между людьми.

## Пример работы приложения:
Друзья отправились в совместное путешествие. На протяжении всего путешествия в разных местах платили разные члены компании за нескольких, поэтому компания хочет поровну рассчитаться.
Один из друзей создает новую группу расходов и отправляет ее в чат компании с помощью [inline](https://core.telegram.org/bots/features#inline-requests) 
запроса к боту. Друзья видят это в чате как отправленное сообщение через бота с кнопкой открытия split-my-check.
При открытии этого приложения друзья присоединяются к этой группе расходов и видят все уже заведенные расходы. 
Вася оплатил арендованную квартиру на всех, поэтому он заносит расход "квартира" с суммой и оставляет выбранное по умолчанию деление расхода поровну между всеми участниками группы.
Потом Петя пошел вечером с Васей и Ваней в ресторан и заплатил за всех, а Антон отправился спать. Петя заносит расход "ресторан" с суммой в чеке и указывает, сколько конкретно из чека заплтил за Васю и Ваню.
В конце путешествия приложение показывает, кто, кому и сколько должен перевести, чтобы рассчитаться за все путешествие.

# Данные
[Посмотреть](https://dbdesigner.page.link/bHqfgk7oNPiskCpj7) схему данных в dbdesigner. Там же обозначены ограничения для каждого элемента данных.

![Схема базы данных](https://media.githubusercontent.com/media/GeorgiySurkov/split-my-check/master/assets/db-schema.png)

## ExpenseGroupParticipant
Отношение между группой расходов и пользователем (Many-to-many), которое описывает, состоит ли пользователь в группе расходов. 

## ExpenseParticipant
Отношение между расходом и пользователем (Many-to-many), которое описывает, на кого был потрачен расход. 
В этой же таблице есть два поля, с помощью которых описывается, какая часть расхода была потрачена на пользователя:
- explicit_part – указывается в копейках. Если не NULL, обозначает абсолютно, сколько денег было потрачено из всего расхода на этого пользователя.
- fraction - натуральное число. Если не NULL, обозначает долю расхода, потраченнную на пользователя. 

Например, если расход был потрачен на 2 людей и для них указан fraction = 1, то система будет считать, что на каждого потрачено ровно половина денег из расхода.
Т.е. расход на человека = (количество денег из расхода) * (fraction из ExpenseParticipant для этого человека) / (сумма всех fraction в этом расходе).

## Общие ограничения целостности
В ExpenseParticipant всегда одно поле из fraction и explicit_part должно быть не NULL.

# Пользовательские роли

## Участник группы расходов
Чтобы иметь эту роль, пользователь должен состоять в какой-либо группе расходов. Перечисленные ниже права имеются только в этой группе.
- Создавать расходы
- Редактировать существующие расходы.
- Удалять расходы

# UI
Приложение будет иметь два интерфейса работы с ним:
- Web SPA (Telegram Web App)
- Telegram bot

Эти интерфейсы не взаимозаменяют, а дополняют друг друга. Через бота создаются новые группы расходов, а через веб приложение идет работа с конкретной группой расходов.

# Технологии разработки

## Web App
- React
- TypeScript
- effector

## Backend
- Python
- aiohttp (Web app API backend)
- pydantic
- aiogram (telegram bot)
- SQLAlchemy
- alembic

## СУБД
PostgreSQL

# Тестирование
Юнит тесты на бизнес логику расчета итогового баланса и ручное тестирование интерфейса/бота.
